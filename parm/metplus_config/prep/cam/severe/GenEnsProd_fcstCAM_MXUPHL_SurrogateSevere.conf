# Creating Surrogate Severe Probabilistic Forecasts from 24-h Max UH

[config]
# Final conf file used by all processes
LOG_DIR = {OUTPUT_BASE}/logs
METPLUS_CONF = {TMP_DIR}/metplus_final_GenEnsProd_{ENV[MODELNAME]}_SurrogateSevere.conf
LOG_METPLUS = {LOG_DIR}/run_metplus.GenEnsProd_{ENV[MODELNAME]}.log.{LOG_TIMESTAMP_TEMPLATE}
SCRUB_STAGING_DIR = False

#
LOOP_ORDER = processes

# List of applications to run
PROCESS_LIST = PCPCombine, GenEnsProd, RegridDataPlane


# time looping - options are INIT, VALID, RETRO, and REALTIME
LOOP_BY = INIT

# Format of INIT_BEG and INIT_END
INIT_TIME_FMT = %Y%m%d%H

# Start and end time for METplus run
INIT_BEG = {ENV[IDATE]}{ENV[vhr]}
INIT_END = {ENV[IDATE]}{ENV[vhr]}

# Increment between METplus runs in seconds. Must be >= 60
INIT_INCREMENT = 3600

# list of forecast leads to process
LEAD_SEQ = {ENV[fhr_end]}



# PCP_COMBINE (Step 1)
# run pcp_combine on forecast data
FCST_PCP_COMBINE_RUN = True

# skip if output already exists
PCP_COMBINE_SKIP_IF_OUTPUT_EXISTS = True

# method to run pcp_combine on forecast data
# Options are ADD, SUM, SUBTRACT, and DERIVE
FCST_PCP_COMBINE_METHOD = DERIVE
FCST_PCP_COMBINE_STAT_LIST = MAX

# field name of 1 hr accumulation in forecast files
FCST_PCP_COMBINE_CONSTANT_INIT = True
FCST_PCP_COMBINE_INPUT_ACCUMS = 1
FCST_PCP_COMBINE_INPUT_NAMES = MXUPHL
FCST_PCP_COMBINE_INPUT_LEVELS = Z2000-5000
FCST_PCP_COMBINE_OUTPUT_NAME = MXUPHL25_A24
FCST_PCP_COMBINE_OUTPUT_ACCUM = 24
FCST_PCP_COMBINE_DERIVE_LOOKBACK = 24 
FCST_PCP_COMBINE_INPUT_DATATYPE = GRIB


FCST_PCP_COMBINE_INPUT_DIR = {ENV[MODEL_INPUT_DIR]}
FCST_PCP_COMBINE_INPUT_TEMPLATE = {ENV[MODEL_INPUT_TEMPLATE]}

FCST_PCP_COMBINE_OUTPUT_DIR = {OUTPUT_BASE}/pcp_combine
FCST_PCP_COMBINE_OUTPUT_TEMPLATE = {ENV[modsys]}.{init?fmt=%Y%m%d}/{ENV[MODELNAME]}.t{init?fmt=%2H}z.{FCST_PCP_COMBINE_OUTPUT_NAME}.{valid?fmt=%Y%m%d%H?shift=-24H}-{valid?fmt=%Y%m%d%H}.f{lead?fmt=%2H}.nc


#[threshold]

#GenEnsProd (Steps 2 and 3)

GEN_ENS_PROD_CONFIG_FILE = {PARM_BASE}/met_config/GenEnsProdConfig_wrapped

ENS_VAR1_NAME = MXUPHL25_A24
ENS_VAR1_LEVELS = "(*,*)"
ENS_VAR1_THRESH = >={ENV[MXUPHL25_THRESH1]}

GEN_ENS_PROD_N_MEMBERS = 1
GEN_ENS_PROD_ENS_THRESH = 1.0
GEN_ENS_PROD_REGRID_TO_GRID = {ENV[VERIF_GRID]}

GEN_ENS_PROD_CENSOR_THRESH = ==-9999
GEN_ENS_PROD_CENSOR_VAL = 0.0

GEN_ENS_PROD_ENSEMBLE_FLAG_LATLON = TRUE
GEN_ENS_PROD_ENSEMBLE_FLAG_MEAN = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_STDEV = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_MINUS = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_PLUS = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_MIN = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_MAX = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_RANGE = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_VLD_COUNT = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_FREQUENCY = TRUE
GEN_ENS_PROD_ENSEMBLE_FLAG_NEP = FALSE
GEN_ENS_PROD_ENSEMBLE_FLAG_NMEP = FALSE


GEN_ENS_PROD_INPUT_DIR = {FCST_PCP_COMBINE_OUTPUT_DIR}
GEN_ENS_PROD_INPUT_TEMPLATE = {FCST_PCP_COMBINE_OUTPUT_TEMPLATE}

GEN_ENS_PROD_OUTPUT_DIR = {OUTPUT_BASE}/gen_ens_prod
GEN_ENS_PROD_OUTPUT_TEMPLATE = {ENV[modsys]}.{init?fmt=%Y%m%d}/{ENV[MODELNAME]}.t{init?fmt=%2H}z.{ENS_VAR1_NAME}_ENS_FREQ.{valid?fmt=%Y%m%d%H?shift=-24H}-{valid?fmt=%Y%m%d%H}.f{lead?fmt=%2H}.nc



# (Step 4) Run RegridDataPlane to smooth binary field into probabilities
#[SSPF]

FCST_REGRID_DATA_PLANE_RUN = True

REGRID_DATA_PLANE_SKIP_IF_OUTPUT_EXISTS = True

REGRID_DATA_PLANE_ONCE_PER_FIELD = False

REGRID_DATA_PLANE_METHOD = MAXGAUSS
REGRID_DATA_PLANE_WIDTH = 1
REGRID_DATA_PLANE_VERIF_GRID = {ENV[VERIF_GRID]}
REGRID_DATA_PLANE_GAUSSIAN_DX = {ENV[VERIF_GRID_DX]}
REGRID_DATA_PLANE_GAUSSIAN_RADIUS = {ENV[GAUSS_RAD]}

FCST_REGRID_DATA_PLANE_VAR1_INPUT_FIELD_NAME = {ENS_VAR1_NAME}_A1_ENS_FREQ_ge{ENV[MXUPHL25_THRESH1]}

FCST_REGRID_DATA_PLANE_VAR1_INPUT_LEVEL = "(*,*)"

FCST_REGRID_DATA_PLANE_VAR1_OUTPUT_FIELD_NAME = Prob_{ENS_VAR1_NAME}_geHWT


FCST_REGRID_DATA_PLANE_INPUT_DIR = {GEN_ENS_PROD_OUTPUT_DIR}
FCST_REGRID_DATA_PLANE_INPUT_TEMPLATE = {GEN_ENS_PROD_OUTPUT_TEMPLATE}

FCST_REGRID_DATA_PLANE_OUTPUT_DIR = {OUTPUT_BASE}/sspf
FCST_REGRID_DATA_PLANE_OUTPUT_TEMPLATE = {ENV[modsys]}.{init?fmt=%Y%m%d}/{ENV[MODELNAME]}.t{init?fmt=%2H}z.{ENS_VAR1_NAME}.SSPF.{valid?fmt=%Y%m%d%H?shift=-24H}-{valid?fmt=%Y%m%d%H}.f{lead?fmt=%2H}.nc

